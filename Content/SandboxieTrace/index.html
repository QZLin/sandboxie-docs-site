<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Sandboxie Trace - Sandboxie Documentation</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Sandboxie Trace";
        var mkdocs_page_input_path = "Content\\SandboxieTrace.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../..">
          <img src="https://avatars.githubusercontent.com/u/63755826?size=64" class="logo" alt="Logo"/>
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Sandboxie documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Help Topics</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../HelpTopics/">Help Topics</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../GettingStarted/">Getting Started</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../UsageTips/">Usage Tips</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Sandboxie Control</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../SandboxieControl/">Sandboxie Control</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../FileMenu/">File Menu</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../ViewMenu/">View Menu</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../SandboxMenu/">Sandbox Menu</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../ConfigureMenu/">Configure Menu</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../HelpMenu/">Help Menu</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../TrayIconMenu/">Tray Icon Menu</a>
                </li>
    </ul>
                  </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../KnownConflicts/">Known Conflicts</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Advanced Topics</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../AdvancedTopics/">Advanced Topics</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../SandboxHierarchy/">Sandbox Hierarchy</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../PrivacyConcerns/">Privacy Concerns</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ServicePrograms/">Service Programs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ResourceAccessMonitor/">Resource Access Monitor (for Sandboxie Classic)</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../PlusContent/TraceLog/">Trace logging (for Sandboxie Plus)</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../HowToUseWinDbg/">How To Use Win Dbg</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Sandboxie Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Sandboxie Trace</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="sandboxie-trace">Sandboxie Trace</h1>
<h3 id="please-see-resource-access-monitor-for-sandboxie-classic">Please see <a href="../ResourceAccessMonitor/">Resource Access Monitor</a> for Sandboxie Classic.</h3>
<h3 id="please-see-trace-logging-for-sandboxie-plus">Please see <a href="../../PlusContent/TraceLog/">Trace Logging</a> for Sandboxie Plus.</h3>
<hr />
<h3 id="overview">Overview</h3>
<p>In some cases, a program may not function correctly within the sandbox, because it needs access to a system resource which is, by default, protected by Sandboxie, and access to that resource is denied.</p>
<p>Note that in this case, the sandboxed program is not creating the resource itself; rather, it expects the resource to already be available for access and use.</p>
<p>The trace displays access attempts and makes it possible to somewhat easily identify which resources that are needed for correct operation, have been blocked.</p>
<h3 id="enable-the-trace">Enable the Trace</h3>
<p>The trace can be activated through different <a href="../SandboxieIni/">Sandboxie Ini</a> settings:</p>
<ul>
<li><strong>FileTrace</strong> logs access to files, folders, and filesystem volumes;</li>
<li><strong>KeyTrace</strong> logs access to registry keys (but not values within keys);</li>
<li><strong>PipeTrace</strong> logs access to named pipes and mail slot objects which are used for inter-process communication;</li>
<li><strong>IpcTrace</strong> logs access to other objects used for inter-process communication, and also logs access attempts by one process to another process;</li>
<li><strong>GuiTrace</strong> logs window-to-window communications;</li>
<li><strong>ClsidTrace</strong> logs COM communications;</li>
<li><strong>NetFwTrace</strong> traces the actions of the firewall components (since version 0.9.0 / 5.51.0);</li>
<li><strong>LogAPI</strong> library to get additional trace output (see <a href="https://forum.xanasoft.com/viewtopic.php?f=12&amp;t=143">this thread</a> for more information).</li>
</ul>
<p>Each setting accepts a sequence of characters which specifies what to log. The character <em>a</em> logs requests which were allowed; the character <em>d</em> logs requests which were denied. For the <strong>FileTrace</strong> and <strong>PipeTrace</strong> settings, the character <em>i</em> logs requests which were allowed because they access a device which is ignored by Sandboxie, such as a CD-ROM.</p>
<p>The settings <strong>PipeTrace</strong>, <strong>IpcTrace</strong> and <strong>GuiTrace</strong> are more relevant to the discussion in this page. <strong>FileTrace</strong> and <strong>KeyTrace</strong> will usually not be able to provide insight as to why a sandboxed program is malfunctioning.</p>
<p>Thus, typically you enable the trace by making this change in <a href="../SandboxieIni/">Sandboxie Ini</a>:</p>
<pre><code>   [GlobalSettings]
   IpcTrace=ad
   PipeTrace=ad
   GuiTrace=ad
</code></pre>
<p>Then use Sandboxie to reload the configuration:
* <strong>Configure</strong> menu -&gt; <strong>Reload Configuration</strong> on Sandboxie Classic
* <strong>Options</strong> menu -&gt; <strong>Reload ini file</strong> on Sandboxie Plus</p>
<p>Trace options can be set on a per box basis such that only the boxes you need will generate trace logs.</p>
<p>You can also adjust the buffer size by adding <code>TraceBufferPages=2560</code> that will increase it tenfold.</p>
<h3 id="review-the-trace-for-netfwtrace-ipctrace-and-pipetrace">Review the Trace for <strong>NetFwTrace</strong>, <strong>IpcTrace</strong> and <strong>PipeTrace</strong></h3>
<p>Since version 0.9.0 / 5.51.0, a new option <code>NetFwTrace=*</code> was added to trace the actions of the firewall components. Please note that the driver only logs to the kernel debug output, which you can view with <a href="https://docs.microsoft.com/en-us/sysinternals/downloads/debugview">DbgView.exe</a>.</p>
<p>On Windows Vista and later, output from the system debugger log is disabled by default. <a href="https://web.archive.org/web/20080731211018/http://blogs.msdn.com:80/doronh/archive/2006/11/14/where-did-my-debug-output-go-in-vista.aspx">This blog post</a> and <a href="https://stackoverflow.com/questions/65015739/outputdebugstring-not-showing-message-in-debugview-windows-10-x64">this StackOverflow thread</a> explain how to enable it.</p>
<p>The following trace will display output in the following format. (Assuming <strong>IpcTrace</strong>, and <strong>PipeTrace</strong> enabled.)</p>
<pre><code>...
(001404) SBIE (FA) 00120116.01.00000000 \Device\NamedPipe\ShimViewer
...
(001404) SBIE (IA) 001F0001 \ThemeApiPort
...
(001404) SBIE (PD) 00000040 001136
(001404) SBIE (PA) 00020400 001136
...
(001404) SBIE (FA) 00000001.0F.FFFFFFFF \Device\Afd\Endpoint
(001404) SBIE (FA) 00000001.0F.FFFFFFFF \Device\Afd
...
(001404) SBIE (ID) 001F0001 \RPC Control\protected_storage
...
</code></pre>
<p>The format is this:</p>
<p><code>(pid) SBIE (ca) (access) (resource)</code></p>
<ul>
<li><code>pid</code> identifies the process attempting the access;</li>
<li><code>c</code> indicates the Sandboxie class for the resource -- more on this later;</li>
<li><code>a</code> indicates if the access was allowed (A) or denied (D);</li>
<li><code>access</code> indicates the access requested to the object, and is typically not interesting or important;</li>
<li><code>resource</code> identifies the resource to which access is desired; in the case of process-to-process access, where <em>ca</em> is (PA) or (PD), the resource name is the process id of the process being accessed.</li>
</ul>
<p>Some examples:</p>
<p><code>(001404) SBIE (IA) 001F0001 \ThemeApiPort</code></p>
<p>Here the process making the request is process id 1404, and was allowed to access the resource named <em>ThemeApiPort</em>. The resource class is I, so this is an inter-process object. The access was allowed because by default, Sandboxie allows this specific access.</p>
<p><code>(001404) SBIE (ID) 001F0001 \RPC Control\protected_storage</code></p>
<p>Here the access to the resource <em>protected_storage</em> was denied. By default Sandboxie does not allow this access; however the OpenProtectedStorage setting changes this behavior.</p>
<p><code>(001404) SBIE (FA) 00000001.0F.FFFFFFFF \Device\Afd\Endpoint</code></p>
<p>Here the access is allowed to the resource <em>Endpoint</em>. The resource class is F, so this is a named pipe or a mail slot resource. The access is allowed by default, because the <em>\Device\Afd</em> prefix names resources needed for Internet access.</p>
<h3 id="review-guitrace-entries">Review <strong>GuiTrace</strong> Entries</h3>
<p>When <strong>GuiTrace</strong> is enabled, the trace also produces entries like the following:</p>
<pre><code>...
(001404) SBIE (GA) WinHook 0002 on tid=001484 pid=001960
(001404) SBIE (GA) AccHook on tid=000000 pid=000000
...
(001404) SBIE (GD) PostMessage 01224 (04C8) to hwnd=00050060 pid=001324 DDEMLMom
(001404) SBIE (GD) SendMessage 49376 (C0E0) to hwnd=00010014 pid=000804 #32769
...
(001404) SBIE (GD) SendInput
(001404) SBIE (GA) SendInput
</code></pre>
<p>These entries have a few formats. The first word after (GA) or (GD) identifies the type of the entry.</p>
<p>When the first word is <em>WinHook</em> or <em>AccHook</em>, the entry indicates installation of a hook. Its installation is permitted for (GA) entries, and denied for (GD) entries. <em>WinHook</em> is a standard Windows hook, followed by the type of the hook (see <a href="https://www.google.com/search?hl=en&amp;q=setwindowshookex+msdn">SetWidowsHookEx in MSDN</a>). <em>AccHook</em> is an accessibility hook (see <a href="https://www.google.com/search?hl=en&amp;q=setwineventhook+msdn">SetWinEventHook in MSDN</a>).</p>
<p>Both entries identify the thread number (tid) process number (pid) into which the hook was to be installed.</p>
<p>When the first word is <em>PostMessage</em>, <em>SendMessage</em> or <em>ThrdMessage</em>, the entry shows denied window communication. The following two numbers indicate the window message number, in decimal and hexadecimal. The entry also indicates the window handle (hwnd) of the target window, the process number (pid) which owns this window, and finally, the internal window class name for the window.</p>
<h3 id="analyze-the-trace">Analyze the Trace</h3>
<p>The point of using the trace is usually to identify the resource that is keeping the sandboxed program from functioning correctly.</p>
<p>Consider for example the following trace record:</p>
<p><code>(001404) SBIE (ID) 001F0001 \BaseNamedObjects\Xyzzy</code></p>
<p>This shows that access to some <em>Xyzzy</em> resource was denied. Sandboxie does not know this resource, and by default, it denies access to unknown resources.</p>
<p>If a sandboxed program begins to malfunction (it may lock up, or it may end abruptly, or just complain about something) soon after this record appears in the trace, it stands to reason that the program was expecting the resource to be accessible.</p>
<p>The next step is to add an <a href="../OpenIpcPath/">OpenIpcPath</a> setting for this resource:</p>
<p><code>OpenIpcPath=\BaseNamedObjects\Xyzzy</code></p>
<p>This setting tells Sandboxie that access to the <em>Xyzzy</em> resource should not be blocked.</p>
<p>Then reload the Sandboxie configuration, clear the old contents of the trace display, and restart the sandboxed program. If the program now performs better, <em>Xyzzy</em> was indeed the problematic resource.</p>
<p>But if the program still fails, the trace log can be inspected again for later (or possibly earlier) failed access attempts.</p>
<h3 id="resource-class">Resource Class</h3>
<p>The trace record shows the Sandboxie resource class of the object. This indicates which OpenXxxPath setting is needed to allow access to the object.</p>
<ul>
<li>When resource class is F, as in (FA) or (FD), the relevant settings are <a href="../OpenFilePath/">OpenFilePath</a> and <a href="../ClosedFilePath/">ClosedFilePath</a>.</li>
<li>When resource class is K, as in (KA) or (KD), the relevant settings are <a href="../OpenKeyPath/">OpenKeyPath</a> and <a href="../ClosedKeyPath/">ClosedKeyPath</a>.</li>
<li>When resource class is I, as in (IA) or (ID), the relevant settings are <a href="../OpenIpcPath/">OpenIpcPath</a> and <a href="../ClosedIpcPath/">ClosedIpcPath</a>.</li>
<li>When resource class is G, as in (GA) or (GD), the relevant setting is <a href="../OpenWinClass/">OpenWinClass</a>.</li>
<li>For COM objects displayed by ClsidTrace, the relevant setting is <a href="../OpenClsid/">OpenClsid</a>.</li>
</ul>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
