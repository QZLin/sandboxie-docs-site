<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Sandbox Hierarchy - Sandboxie Documentation</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Sandbox Hierarchy";
        var mkdocs_page_input_path = "Content\\SandboxHierarchy.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../..">
          <img src="https://avatars.githubusercontent.com/u/63755826?size=64" class="logo" alt="Logo"/>
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Sandboxie documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Help Topics</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../HelpTopics/">Help Topics</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../GettingStarted/">Getting Started</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../UsageTips/">Usage Tips</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Sandboxie Control</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../SandboxieControl/">Sandboxie Control</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../FileMenu/">File Menu</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../ViewMenu/">View Menu</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../SandboxMenu/">Sandbox Menu</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../ConfigureMenu/">Configure Menu</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../HelpMenu/">Help Menu</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../TrayIconMenu/">Tray Icon Menu</a>
                </li>
    </ul>
                  </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../KnownConflicts/">Known Conflicts</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Advanced Topics</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../AdvancedTopics/">Advanced Topics</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Sandbox Hierarchy</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#files">Files</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#registry">Registry</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#inter-process-objects">Inter-Process Objects</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../PrivacyConcerns/">Privacy Concerns</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ServicePrograms/">Service Programs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ResourceAccessMonitor/">Resource Access Monitor (for Sandboxie Classic)</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../PlusContent/TraceLog/">Trace logging (for Sandboxie Plus)</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../HowToUseWinDbg/">How To Use Win Dbg</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Sandboxie Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Advanced Topics</li>
      <li class="breadcrumb-item active">Sandbox Hierarchy</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="sandbox-hierarchy">Sandbox Hierarchy</h1>
<h3 id="overview">Overview</h3>
<p>When sandboxed programs create (or modify) objects, such as files, in fact, some kind of data should be created. Sandboxie creates these objects out of the way, to protect the system from harmful changes. But these objects must reside somewhere in the system. This page describes where various types of sandboxed objects are placed.</p>
<p>Beginning with version 2.80 of Sandboxie, the layout of the sandbox is not tied to computer-specific device names and account names. See <a href="../PortableSandbox/">Portable Sandbox</a> for more information.</p>
<h3 id="files">Files</h3>
<p>Files are created in the <em>Sandbox</em> folder according to the following hierarchy:</p>
<pre><code>  . FileRootPath
  . . drive
  . . . C
  . . . D
  . . . Q
  . . user
  . . . all
  . . . current
</code></pre>
<p>The <a href="../FileRootPath/">FileRootPath</a> setting specifies a path to the root of a particular sandbox. In other words, if <a href="../FileRootPath/">FileRootPath</a> specifies the folder <em>C:\MySandbox</em>, then the sub-folders <em>drive</em> and <em>user</em> are created as <em>C:\MySandbox\drive</em> and <em>C:\MySandbox\user,</em> respectively.</p>
<p>If the <a href="../FileRootPath/">FileRootPath</a> setting is omitted, the <a href="../BoxRootFolder/">BoxRootFolder</a> setting is used instead. The <a href="../BoxRootFolder/">Box Root Folder</a> setting specifies a path to a group of sandboxes. In other words, if <a href="../BoxRootFolder/">Box Root Folder</a> specifies the folder <em>C:\MySandbox</em>, then the sub-folders <em>drive</em> and <em>user</em> are created as <em>C:\MySandbox\Sandbox\DefaultBox\drive</em> and <em>C:\MySandbox\Sandbox\DefaultBox\user,</em> respectively, and assuming the sandbox is called DefaultBox. Please note that <a href="../BoxRootFolder/">BoxRootFolder</a> is a deprecated setting.</p>
<p>As sandboxed programs create new files or modify existing files, Sandboxie redirects these operations to act on paths that lead into the sandbox. If the sandboxed program was trying to create the file <em>C:\NEW.TXT</em>, it will be redirected to create instead <em>(<a href="../FileRootPath/">FileRootPath</a>)\drive\C\NEW.TXT</em>.</p>
<p>If the sandboxed program was trying to create the file <em>C:\Users\joe\Documents\NEW.TXT</em>, it will be redirected to create <em>(<a href="../FileRootPath/">FileRootPath</a>)\user\current\Documents\NEW.TXT</em>.</p>
<p>Files that are created or modified in or below <em>profile</em> (or <em>home</em>) folders, such as <em>C:\Users\joe</em> (on Windows Vista and later) are redirected into the sandboxed <em>user\current</em> folder.</p>
<p>Files that are created or modified in or below the generic (or <em>All Users</em>) profile, are redirected into the sandboxed <em>user\all</em> folder.</p>
<p>Other files that don't match either of the above paths are redirected to the sandboxed <em>drive\X</em> folder, where <em>X</em> would be the drive in which the files were <em>supposed</em> to have been written.</p>
<p>Files that are created or modified on a remote network share are redirected into the sandboxed <em>share\servername\sharename</em> folder.</p>
<p>When a program tries to open a file for which a copy already exists in the sandbox, Sandboxie will redirect the program to the copy of the file that was previously stored in the sandbox. On the other hand, if a copy for the file does not exist in the sandbox, and if the program does not try to modify the file, then Sandboxie will permit read-only access on the original file outside the sandbox. This behavior can be affected with the file-related settings <a href="../OpenFilePath/">OpenFilePath</a>, <a href="../ReadFilePath/">ReadFilePath</a>, and <a href="../ClosedFilePath/">ClosedFilePath</a>.</p>
<p>Note that the <em>Sandbox</em> folder itself resides on one particular drive, so even as sandboxed programs may create and modify files in multiple drives, all these files will end up residing <em>physically</em> in the same drive -- the drive where the <em>Sandbox</em> folder resides.</p>
<p>Apart from the two sub-folders, <em>drive</em> and <em>user</em>, the <em>Sandbox</em> folder itself contains the file <em>RegHive</em>, and typically also <em>RegHive.LOG</em>. These hold the sandboxed registry. See below.</p>
<h3 id="registry">Registry</h3>
<p>Registry keys are created in a sandboxed registry hive. A <em>registry hive</em> is the Microsoft Windows term for a group of related registry keys that are stored in a single <em>hive file</em>.</p>
<p>Sandboxie creates the hive file in the <em>Sandbox</em> folder, as the files <em>RegHive</em> and <em>RegHive.LOG</em>. This hive is mounted (or in other words, loaded into the registry) when a sandboxed program starts. The hive is unmounted when all sandboxed programs end.</p>
<p>The sandboxed hive has the following position and structure within the global structure of the Windows registry.</p>
<pre><code> . HKEY_USERS
 . . KeyRootPath
 . . . machine
 . . . user
 . . . . current
</code></pre>
<p>The <a href="../KeyRootPath/">KeyRootPath</a> setting specifies a path to the root of a particular sandbox. If omitted, it defaults to <em>HKEY_USERS\Sandbox</em>(user name)<em>(sandbox name)</em>. For example, if the user joe is using the sandbox DefaultBox, the default <a href="../KeyRootPath/">KeyRootPath</a> is <em>HKEY_USERS\Sandbox_joe_DefaultBox</em>.</p>
<p>As sandboxed programs create new registry keys or modify existing keys, Sandboxie redirects these operations to act on paths that lead into the sandbox. If the sandboxed program was trying to create the key <em>HKEY_LOCAL_MACHINE\Software\NewKey</em>, it will be redirected to create instead <em>(<a href="../KeyRootPath/">KeyRootPath</a>)\machine\Software\NewKey</em>.</p>
<p>If the sandboxed program was trying to create the key <em>HKEY_CURRENT_USER\Software\NewKey</em>, it will be redirected to create <em>(<a href="../KeyRootPath/">KeyRootPath</a>)\user\current\Software\NewKey</em>.</p>
<p>With the sandboxed registry, the rules for redirection are simpler than for sandboxed files:</p>
<ul>
<li>
<p>A registry key created or modified below the HKEY_LOCAL_MACHINE tree will be redirected below the sandboxed <em>machine</em> key.</p>
</li>
<li>
<p>A registry key created or modified below the HKEY_CURRENT_USER tree will be redirected below the sandboxed <em>user\current</em> key.</p>
</li>
<li>
<p>A registry key created or modified below the HKEY_CLASSES_ROOT tree will be redirected below the sandboxed <em>user\current_classes</em> key.</p>
</li>
</ul>
<p>Note that the sandboxed <em>user\current\software\classes</em> key is a symbolic link to the <em>user\current_classes</em> key which means and the keys are effectively synonyms and share the same content in the sandboxed Windows registry.</p>
<p>As with files, access to a key which has a copy in the sandboxed registry will be redirected to use the copy in the sandbox. Read-only access to a key which does not have a copy in the sandboxed registry will be permitted to access the key outside the sandbox. This behavior can be affected with the registry-related settings <a href="../OpenKeyPath/">OpenKeyPath</a>, <a href="../ReadKeyPath/">ReadKeyPath</a>, and <a href="../ClosedKeyPath/">ClosedKeyPath</a>.</p>
<h3 id="inter-process-objects">Inter-Process Objects</h3>
<p>These objects are used by programs to share information, synchronize processing, and provide services. These objects are never written to disk and they disappear when the system shuts down.</p>
<p>Sandboxie isolates these objects in order to make it possible to run the same program sandboxed and un-sandboxed side-by-side. It also keeps sandboxed programs from interfering with un-sandboxed ones.</p>
<p>These objects are created in the NT object namespace. Their position and structure within that namespace are as follows.</p>
<pre><code> . IpcRootPath
 . . BaseNamedObjects
 . . . Global
 . . . Local
 . . . Session
 . . RPC Control
</code></pre>
<p>The <a href="../IpcRootPath/">IpcRootPath</a> setting specifies a path to the root of a particular sandbox. If omitted, it defaults to <em>\Sandbox(user name)(sandbox name)\Session</em>(session number)<em>. For example, if the user joe is running in session zero, and using the sandbox DefaultBox, the default <a href="../IpcRootPath/">IpcRootPath</a> is </em>\Sandbox\joe\DefaultBox\Session_0_.</p>
<p>Below the <a href="../IpcRootPath/">IpcRootPath</a>, there are <em>object directories</em> which comprise the NT namespace, and match the layout of existing object directories outside the sandbox area. The directories are created with a <em>persistent</em> attribute, which means they will only disappear at system shutdown.</p>
<p>Objects created by sandboxed programs are created within the sandbox object directories. If the program is running outside the supervision of Sandboxie, it would typically create such objects in the \BaseNamedObjects object directory.</p>
<p>Note that objects may be created without a name, in which case the object is effectively isolated to the particular program which created it. However, a program can access the internals of another program in order to locate and use such nameless objects. To mitigate this, Sandboxie prevents a program in the sandbox from accessing a program outside the sandbox in this way.</p>
<p>The free utility <a href="https://docs.microsoft.com/en-us/sysinternals/downloads/winobj">WinObj</a> by Sysinternals (now a part of Microsoft) can be used to display the NT object namespace.</p>
<p>Unlike the case with files or registry keys, sandboxed programs are never permitted to access IPC objects outside the sandbox namespace, not even for read-only access. This behavior can be affected with the registry-related settings <a href="../OpenIpcPath/">OpenIpcPath</a> and <a href="../ClosedIpcPath/">ClosedIpcPath</a>.</p>
<p>Note that Sandboxie includes a number of built-in <a href="../OpenIpcPath/">OpenIpcPath</a> settings to allow programs to function correctly, and in a typical system, more <a href="../OpenIpcPath/">OpenIpcPath</a> settings are applied through compatibility settings for third-party software.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../AdvancedTopics/" class="btn btn-neutral float-left" title="Advanced Topics"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../PrivacyConcerns/" class="btn btn-neutral float-right" title="Privacy Concerns">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../AdvancedTopics/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../PrivacyConcerns/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
